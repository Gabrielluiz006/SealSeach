<?php
require_once '../seguranca_usuario.php';

try {
    
    if(isset($_GET['campo'],$_GET['email'])) {
        
        // se o get for diferente de 1 ou nao for numero
        if($_GET['campo'] != 1 || !is_numeric($_GET['campo'])) {
            header('Location: ../login_cadastro_usuario/logout_usuario.php');
        }
        
        $con = getConexao();
        /* verifica se existe algum problema de conexao, caso exista, redireciona para pagefound
         * evitando assim, mostrar os diretorios da pasta
         */
        if($con === null) {
            header('Location: ../pagefound.php');
        }
        $con->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        
        $campo = filter_input(INPUT_GET, 'campo', FILTER_VALIDATE_INT);
        $email = filter_input(INPUT_GET, 'email', FILTER_VALIDATE_EMAIL);
        
        $sql = 'UPDATE cliente SET confirma_email = :campo WHERE email = :email;';
        
        $stmt = $con->prepare($sql);
        
        $stmt->bindParam(':email', $email);
        $stmt->bindParam(':campo', $campo);
        
        if($stmt->execute()) {
            $_SESSION['msgDeVerificacao'] = "Cadastrado com sucesso";
            $con = null;
            header('Location: ../../PP1_FRONT/Cadastro.php');
            
        }else {
            $_SESSION['msgValidacaoEmailFail'] = "<script> alert('Não foi possível confirma seu email, por favor entre em contato com o suporte');</script>";
            $con = null;
            header('Location: ../../PP1_FRONT/Home.php');
        }
        
    }else {
        header('Location: ../logout_usuario.php');
    }
    
} catch (Exception $ex) {
    echo $ex->getCode(); echo $ex->getMessage();
}
