<?php
/* php.ini
session.cookie_httponly=1;
session.cookie_secure=1;
session.use_only_cookies=1; */

define('TEXT_SEGURANCA', 'W4r/N0Mor3Trouble@&St0pWar@');

if(!isset($marcaTempoCache)) {
    session_cache_expire(10);
    $marcaTempoCache = session_cache_expire();
}else {
    session_cache_expire($marcaTempoCache);
}
        
session_start();


// aqui renova o id da sessa caso tenha passado o tempo
if($marcaTempoCache <= 3) {
    session_regenerate_id();
    /*
     * ainda vou modificar essa renovacao de sessao
     */
}

// cria um token de sessao
$tokenSessao = hash('sha512', $_SERVER['REMOTE_ADDR'].$_SERVER['HTTP_USER_AGENT'].TEXT_SEGURANCA.session_id());

/* verifica se existe algum token da sessao existe
 * caso exista, ele verifica se é igual ao da sessao existente
 */
if(isset($_SESSION['tokenUsuarioLogado'])) {
    if(!hash_equals($tokenSessao, $_SESSION['tokenUsuarioLogado'])) {
        header('Location: ../login_cadastro_usuario/logout_usuario.php');
    }
}