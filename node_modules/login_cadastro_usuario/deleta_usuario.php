<?php
require_once './seguranca_usuario.php';

try {
    $con = getConexao();
    /* verifica se existe algum problema de conexao, caso exista, redireciona para pagefound
     * evitando assim, mostrar os diretorios da pasta
     */
    if($con === null) {
        header('Location: ./pagefound.php');
    }
    $con->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    $token_user = filter_var($_SESSION['token_user'], FILTER_SANITIZE_SPECIAL_CHARS);
    
    $sql_deleta_conta = 'DELETE FROM cliente WHERE token_session = :token_session;';
    
    $stmt = $con->prepare($sql_deleta_conta);
    
    $stmt->bindParam(':token_session', $token_user);
    
    if($stmt->execute()) {
        $_SESSION = array();
        $_SESSION['contaDeletadaSucess'] = true;
        $con = null;
        header('Location: ../PP1_FRONT/Home.php');
        
    }else {
        $_SESSION['contaDeletadaFail'] = false;
        $con = null;
        header('Location: ../PP1_FRONT/Perfil.php');
    }
    
} catch (PDOException $ex) {
    echo $ex->getCode(); echo $ex->getMessage();
}
