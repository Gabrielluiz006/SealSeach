<?php
function validaCpf($cpf_user) {    

                /*
                 * a validadao do cpf é feita da seguinte forma
                 * o primeiro DV(digito de verificacao) é a soma de cada numero do cpf
                 * multiplicado pelo peso dele, de 1 ate 9, soma tudo e divide por 11
                 * caso a divisao de em resto 10, ele é considerado 0
                 * 
                 * dps disso o segundo DV é encontrado de maneira similar
                 * onde se adiciona o DV encontrado da primeira parte
                 * e a multiplicacao pelo peso de cada numero agora é de 0 ate 9
                 * e se esses calculos baterem com o que o usuario digitou é validado o cpf
                 */
                
                // verifica se tem o sinal -
                if(strpos($cpf_user,'-') === false) {
                    return false;
                    
                }
                
                // verifica o tamanho do cpf para validar
                if(strlen($cpf_user) < 12 || strlen($cpf_user) > 14) {
                    return false;
                }
                
                // troca os pontos caso o usuario coloque
                $cpf_form = str_replace('.', '', $cpf_user);
                
                // pega os 9 primeiros digitos
                $cpf = substr($cpf_form, 0, 9);
                
                // verifica se sao apenas numeros
                if(!is_numeric($cpf)) {
                    return false;
                }
                
                // o codigo para verificar se o cpf é valido começa aqui
                
                $numCpf = []; // array que vai conter cada numero do cpf
                $valoresTotalCpf = 0; // variavel que vai conter soma total da multiplicacao de cada numero
                
                for ($i = 0; $i < 9; $i++) {
                    // converte cada string numerica para numero e passa para uma possicao do array
                    $numCpf[$i] = (int) $cpf[$i];
                }
                
                for ($i = 0; $i < 9; $i++) {
                    // variavel recebe o valor da multiplicacao e ja soma com o valor que ela tiver
                    $valoresTotalCpf += $numCpf[$i] * ($i+1);
//                    echo "<br>".$numCpf[$i] ."*". ($i+1);
                }
                
                // mod da soma total
                $valoresTotalCpf %= 11;
                if($valoresTotalCpf === 10) {
                    $valoresTotalCpf = 0;
                } 
                
                // dps de todo o processo o primeiro DV foi adicionado
                $cpf .= "-".$valoresTotalCpf;
                
                // agora so uma repeticao do que foi antes
                $numCpf = [];
                
                for ($i = 0; $i < 10; $i++) {
                    $numCpf[$i] = (int) $cpf[$i];
                }
                
                // adiciona um valor a mais no array que é o DV
                $numCpf[9] = $valoresTotalCpf;
                $valoresTotalCpf = 0;
                
                for ($i = 0; $i <= 9; $i++) {
                    $valoresTotalCpf += $numCpf[$i] * $i;
//                    echo "<br>".$numCpf[$i] ."*". $i;
                }
                
                $valoresTotalCpf %= 11;
                if($valoresTotalCpf === 10) {
                    $valoresTotalCpf = 0;
                }
                
                $cpf .= $valoresTotalCpf;
                
                // formatacao do cpf caso necessite imprimir
//                $cpf_formatado = "";
//                for($i = 0; $i < 12; ++$i) {
//                    if($i === 3 || $i === 7) {
//                        $cpf_formatado .= ".$cpf[$i]";
//                    }else {
//                        $cpf_formatado .= $cpf[$i];
//                    }
//                }
                
                // agora verifica se os 2 DV sao iguais
                if($cpf[10] !== $cpf_form[10] || $cpf[11] !== $cpf_form[11]) {
                    return false;
                }else {
                    return true;
                }

}
